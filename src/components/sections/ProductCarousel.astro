---
import { Icon } from "astro-icon/components";
import type { Product } from "../../types/product";
import type { ProductCardVariant } from "../../types/productCard";
import ProductCard from "../ui/ProductCard.astro";

const {
  title,
  subtitle = "Destacados",
  products = [],
  href = "#",
  id = "carousel",
  getVariant,
} = Astro.props as {
  title: string;
  subtitle?: string;
  products: Product[];
  href?: string;
  id?: string;
  getVariant?: (product: Product) => ProductCardVariant;
};
---

<section class="w-full">
  <div class="flex items-end justify-between gap-4 mb-4">
    <div>
      <p class="text-xs tracking-widest uppercase text-neutral-500">{subtitle}</p>
      <h2 class="text-xl md:text-2xl font-semibold text-neutral-900">{title}</h2>
    </div>

    <div class="flex items-center gap-2">
      <a href={href} class="text-sm font-medium text-neutral-900 hover:underline">Ver todo</a>

      <button
        class="hidden md:inline-flex h-10 w-10 items-center justify-center rounded-full border border-neutral-200 hover:border-neutral-300 cursor-pointer"
        data-prev={id}
        aria-label={`Anterior ${title}`}
        type="button"
      >
        ‹
      </button>
      <button
        class="hidden md:inline-flex h-10 w-10 items-center justify-center rounded-full border border-neutral-200 hover:border-neutral-300 cursor-pointer"
        data-next={id}
        aria-label={`Siguiente ${title}`}
        type="button"
      >
        ›
      </button>
    </div>
  </div>

  <div
    id={id}
    class="relative -mx-4 px-4 overflow-x-auto scroll-smooth overflow-visible pt-5"
    style="scrollbar-width: none;"
  >
    <div class="flex gap-10 snap-x snap-mandatory">
      {products.map((p) => (
        <ProductCard product={p} variant={getVariant ? getVariant(p) : {}} />
      ))}
    </div>
  </div>

  <script define:vars={{ id }}>
    const root = document.getElementById(id);
    if (root) {
      const prev = document.querySelector(`[data-prev="${id}"]`);
      const next = document.querySelector(`[data-next="${id}"]`);

      const scrollByCard = () => {
        // mueve aprox 1 tarjeta (la primera del carrusel)
        const card = root.querySelector("a");
        const gap = 16;
        return card ? card.getBoundingClientRect().width + gap : 320;
      };

      prev?.addEventListener("click", () => root.scrollBy({ left: -scrollByCard(), behavior: "smooth" }));
      next?.addEventListener("click", () => root.scrollBy({ left: scrollByCard(), behavior: "smooth" }));
    }
  </script>
</section>